# c('regulation','imf_non_healthcare'),
# c('sector_f','imf_loans_pc'),
# c('sector_q','imf_non_healthcare_pc'),
# c('stability','imf_budget_included')
# c('vote_thresh','imf_budget_included'),
# c('vote_thresh','imf_healthcare')
# )
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1),method = 'lm',colour="dark green", se = FALSE) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0),method = 'lm',colour="orange", se = FALSE) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green') +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange') +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue') +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red')+
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
# ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1),method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(formula = y ~ x,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE,
label.x.npc = "right") +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0),method = 'lm',colour="orange", se = FALSE) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green') +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange') +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue') +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red')+
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
# ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
stat_poly_eq(data = tests_positive_data,
formula = ISR_Reg,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE) +
lapply(pairs,plot_corr)
library(ggpmisc)
install.packages('ggpmisc')
library(ggpmisc)
stat_poly_eq(data = tests_positive_data,
formula = ISR_Reg,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE) +
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1),method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(formula = y ~ x,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE,
label.x.npc = "right") +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0),method = 'lm',colour="orange", se = FALSE) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green') +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange') +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue') +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red')+
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
# ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
stat_poly_eq(data = tests_positive_data,
formula = ISR_Reg,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE) +
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1),method = 'lm',colour="dark green", se = FALSE) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0),method = 'lm',colour="orange", se = FALSE) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green') +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange') +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue') +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red')+
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
# ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
stat_poly_eq(formula = y ~ x,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE,
label.x.npc = "right") +
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1),method = 'lm',colour="dark green", se = FALSE) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0),method = 'lm',colour="orange", se = FALSE) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green') +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange') +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue') +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red')+
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
# ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
stat_poly_eq(data = tests_positive_data,
formula = ISR_Reg,
aes(label = paste(..rr.label.., sep = "~~~")),
parse = TRUE) +
lapply(pairs,plot_corr)
library(ggplot2)
library(readxl)
library(dplyr)
library(stargazer)
library(ggpmisc)
#############################        DATA IMPORT & TRANSFORMATIONS        #############################
path <- "C://Users//nirgo//Documents//GitHub//Fiscal_Multipliers//פרק ו//תכניות הקורונה הממשלתיות//השוואה בינל//Plots"
# Import data
data <- read_xlsx('C://Users//nirgo//Documents//GitHub//Fiscal_Multipliers//פרק ו//תכניות הקורונה הממשלתיות//השוואה בינל//data_changed.xlsx',
sheet = 'Sheet1')
# Apply log transformations on some of the variables
# data['log_gdp'] <- log(data$gdp)
data['log_pop'] <- log(data$population)
data['log_cases'] <- log(data$cases_cum)
data['log_deaths'] <- log(data$deaths_cum)
data['log_deaths'] <- log(data$deaths_cum)
# data['imf_non_health_accelerated'] <- data['imf_non_healthcare']+data['imf_accelerated']
# Assign NA values to countries with unknown election vote threshold
data[data$vote_thresh < 0, 'vote_thresh'] <- NA
# Create some more variables
data['firms_total'] <- data$firms_budget_excluded + data$firms_budget_included
# Calculate OECD average stats
OECD_mean <- apply(data[,-c(1:3)], 2, function(x) mean(x, na.rm=T))
data <- rbind(data, c('OECD', 'OECD', 'OECD', unname(as.list(OECD_mean))))
# Seperate between Israel and the rest of the countries, for visualization purposes
ISR <- data[data$country_code == 'ISR',]
NON_ISR <- data[data$country_code != c('ISR', 'OECD'),]
OECD <- data[data$country_code == 'OECD',]
# log GDP vs. Cumulative covid-19 tests
pairs <- list(
# c('age_85_plus','imf_healthcare'),
# c('beds','imf_healthcare'),
c('debt_gdp','imf_healthcare'),
c('debt_gdp','imf_nonhealth_accerlerated'),
c('credit_rating','imf_healthcare'),
c('credit_rating','imf_nonhealth_accerlerated'),
c('avg_deficit','imf_healthcare'),
c('avg_deficit','imf_nonhealth_accerlerated'),
c('doctors','imf_healthcare'),
c('health_spending','imf_healthcare')
)
# c('health_spending','imf_healthcare'),
# c('credit_rating','imf_accelerated'),
# c('log_gdp','imf_accelerated'),
# c('pre_interest','imf_budget_included'),
# c('self_employed','imf_budget_included'),
# c('debt_interest_payments','imf_healthcare'),
# c('structural_balance','imf_healthcare'),
# c('gov_spending','imf_non_healthcare_pc'),
# # c('debt_gdp','imf_quasi'),
# c('nurses','imf_healthcare_pc'),
# c('regulation','imf_non_healthcare'),
# c('sector_f','imf_loans_pc'),
# c('sector_q','imf_non_healthcare_pc'),
# c('stability','imf_budget_included')
# c('vote_thresh','imf_budget_included'),
# c('vote_thresh','imf_healthcare')
# )
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 2) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 2) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue') +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red')+
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 2) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 2) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue', size = 2) +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red', size = 2) +
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 2) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 2) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue', size = 3) +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red', size = 3) +
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, rr.digits = 2, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, rr.digits = 2, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 2) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 2) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue', size = 3) +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red', size = 3) +
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 2) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 2) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue', size = 3) +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red', size = 3) +
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 5) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 5) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue', size = 6) +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red', size = 6) +
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
plot_corr <- function(pair){
lm_eqn <- function(df){
m <- lm(y ~ x, df);
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits = 2),
b = format(unname(coef(m)[2]), digits = 2),
r2 = format(summary(m)$r.squared, digits = 2)))
as.character(as.expression(eq));
}
formula <- y ~ x
exclud1 <- ifelse(pair[1]=="debt_gdp","Japan",
ifelse(pair[1]=="credit_rating","Greece",""))
exclud2 <- ifelse(pair[1]=="debt_gdp","Greece",
ifelse(pair[1]=="credit_rating","Turkey",""))
ggplot(data = data,aes_string(x=pair[1],y=pair[2])) +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, method = 'lm',colour="dark green", se = FALSE) +
stat_poly_eq(data =  data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==1), formula = formula, colour='dark green', parse = T, label.x.npc = 'right') +
geom_smooth(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, method = 'lm',colour="orange", se = FALSE) +
stat_poly_eq(data = data%>%filter(!country_name %in% c(exclud1,exclud2) & above_avg_death==0), formula = formula, colour='orange', parse = T, label.x.npc = 'right', label.y.npc = 0.9) +
geom_text(data = data %>% filter(above_avg_death==1 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'dark green', size = 4) +
geom_text(data = data %>% filter(above_avg_death==0 & !country_code %in% c("ISR","OECD")), aes(label=country_code), colour = 'orange', size = 4) +
geom_text(data = data %>% filter(country_code == "ISR"), aes(label=country_code), colour = 'blue', size = 5) +
geom_text(data = data %>% filter(country_code == "OECD"), aes(label=country_code), colour = 'red', size = 5) +
theme(axis.text=element_text(),axis.title=element_text(face="bold"))
ggsave(filename = paste0(pair[1],"_",pair[2],'.png'),path = path,width=6,height=5,units="in")
}
lapply(pairs,plot_corr)
# In this file we'll create some visualizations that are more easily produced in R than Python
# Loading libraries
library(ggplot2)
library(ggpmisc)
# setting working directory
setwd('C:/Users/nirgo/Documents/GitHub/Fantasy')
# Loading data. SGW - Single Game Week (i.e, not cumulative). CUM - cumulative data until GW 19.
sgw_data <- read.csv('Final Data.csv')
cum_data <- read.csv('./Cumulative Merged Data/CMD_S21_GW_19.csv')
Encoding(sgw_data$Player) <- 'UTF-8'
library(tidyr)
install.packages('formattable')
library(formattable)
# Produce stability stats and visualize them as table
stable_players = pivot_wider(sgw_data,
names_from = Player,
values_from = Pts.)
View(stable_players)
# Produce stability stats and visualize them as table
stable_players = pivot_wider(sgw_data,
names_from = Gameweek,
values_from = Pts.)
View(stable_players)
# Produce stability stats and visualize them as table
stable_players = pivot_wider(sgw_data,
id_cols = c(Gameweek, Player, Pts.)
names_from = Gameweek,
values_from = Pts.)
# Produce stability stats and visualize them as table
stable_players = pivot_wider(sgw_data,
id_cols = c(Gameweek, Player, Pts.),
names_from = Gameweek,
values_from = Pts.)
stable_players <- spread(sgw_data,
key = Player,
value = Gameweek,
fill = Pts.)
install.packages("tidyverse")
library(tidyverse)
# Drop duplicates
sgw_data <- sgw_data[!duplicated(sgw_data)]
View(sgw_data)
# Drop duplicates
sgw_data <- sgw_data %>% distinct()
# Produce stability stats and visualize them as table
stable_players = pivot_wider(sgw_data,
names_from = Gameweek,
values_from = Pts.)
View(stable_players)
# Produce stability stats and visualize them as table
stable_players <- pivot_wider(sgw_data,
names_from = Gameweek,
values_from = Pts.)
stable_players <- spread(sgw_data,
key = Player,
value = Gameweek,
fill = Pts.)
# Produce stability stats and visualize them as table
stable_players <- pivot_wider(sgw_data,
names_from = Gameweek,
values_from = c(Player,Pts.)
# Produce stability stats and visualize them as table
stable_players <- pivot_wider(sgw_data,
names_from = Gameweek,
values_from = c(Player,Pts.))
View(sgw_data)
# Produce stability stats and visualize them as table
stable_players <- pivot_wider(sgw_data,
names_from = Gameweek,
values_from = c(Player, Pts.))
# In this file we'll create some visualizations that are more easily produced in R than Python
# Loading libraries
library(ggplot2)
library(ggpmisc)
library(tidyr)
library(tidyverse)
library(formattable)
# setting working directory
setwd('C:/Users/nirgo/Documents/GitHub/Fantasy')
# Loading data. SGW - Single Game Week (i.e, not cumulative). CUM - cumulative data until GW 19.
sgw_data <- read.csv('Final Data.csv')
cum_data <- read.csv('./Cumulative Merged Data/CMD_S21_GW_19.csv')
# Changing encoding for R doesn't catch well some of the latin players' names
Encoding(cum_data$Player) <- 'UTF-8'
Encoding(sgw_data$Player) <- 'UTF-8'
# Drop duplicates
sgw_data <- sgw_data %>% distinct()
rm(stable_players)
stable_players <- pivot_wider(sgw_data,
names_from = Gameweek,
values_from = c(Player, Pts.))
# Produce stability stats and visualize them as table
stable_players <- pivot_wider(sgw_data,
names_from = Gameweek,
values_from = Player,
values_fill = Pts.)
stable_players <- spread(sgw_data,
key = Player,
value = Gameweek,
fill = Pts.)
stable_players <- spread(sgw_data %>% select(c(Player, Gameweek, Pts.)),
key = Player,
value = Gameweek)
stable_players <- spread(sgw_data %>% select(c(Player, Gameweek, Pts.)),
key = Gameweek,
value = Pts.)
